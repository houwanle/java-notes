# Linux最常用命令（四）：用户和用户组

用户是指在一个操作系统中，一系列权限的集合体，操作人员通过用户名和口令可以在系统中执行某一些被允许的操作。不同的用户可以具有不同的权限。Linux操作系统中每个用户都具有唯一标识UID，当使用命令创建用户时，如果不指定用户的UID，则系统将自动为其分配UID。

用户组就是具有相同特征的用户的集合体，在Linux系统中，每一个用户都属于至少一个用户组。Linux 操作系统中每个用户分组都具有唯一标识 GID ，当使用命令创建用户组时，如果不指定用户组的 GID，则系统将自动为其分配 GID。当使用 -u 指定用户 id 时，用户 id 尽量大于500，以免冲突。因为 Linux 操作系统安装后，会默认建立一些用户，所以可能会占用500之内的 id 号。

**Linux 权限机制有以下特点：**
- 系统有一个权限最大的用户，其名称为 root，root 用户属于 root 用户组。
- 系统默认只有 root 权限可以添加和删除用户。
- 添加用户之后，如果没有给用户指定用户组，则系统会为用户添加一个同名的用户组，用户属于该组。
- root 切换到普通用户无需登录，普通用户切换到 root 用户需要登录。
- root 可以给用户赋予和回收某一个文件的读、写、执行的权限。

## 用户操作命令

### 切换用户命令

```bash
su
```

- ```su [用户名]``` 或者 ```su -[用户名]```
- ```su [用户名]``` 和 ```su -[用户名]``` 都可以切换用户，前者类似于临时切换用户，当使用该命令进行切换新用户时，用户配置仍然沿用原来的用户配置，如环境变量、系统变量等。而后者进行切换用户时，环境变量、系统设置全部切换成新用户的用户配置。

### 查看当前登录用户命令

```bash
whoami
```

### 查看当前用户所属分组命令

```bash
groups
```

### 查看用户 UID 和 GID 命令

```bash
id
```

### 添加新用户命令

```bash
useradd
```

取值 | 说明
---|---
-c | 代表 comment 指定一段注释性描述
-d | 指定用户主目录
-g | 指定用户所属的用户组
-G | 指定用户所属的附加组
-u | 指定用户的用户号
缺省 | 直接添加用户

在 Linux 操作系统中添加用户：```useradd 用户名```

在 Linux 操作系统中添加用户并指定用户 UID：```useradd -u```

### 修改用户密码命令

```bash
passwd
```

例如：修改当前用户名 sang 的用户密码：```passwd sang```；在添加用户之后，只有为其设置密码，用户才能登录。


取值 | 说明
---|---
-d | 删除密码，仅有系统管理员才能使用。
-f | 强制执行
-k | 设置只有密码过期后才能更新
-l | 锁着密码
-s | 列出面膜的相关信息，仅有系统管理员才能使用
-u | 解开已上锁的账号

### 删除用户命令

```bash
userdel
```

- 删除用户：```userdel 用户名```
- 删除用户并同时删除其登录信息：```userdel -r 用户名```

取值 | 说明
---|---
-r | 删除用户以及其登录日志等信息
-f | 强制删除用户，即使用户已经登录
缺省 | 直接删除用户


### 修改用户信息命令

```bash
usermod
```

- 语法：```usermod [选项] [参数] [用户名]```
- 修改用户登录名：```usermod -l 新用户名 旧用户名```
- 修改用户所属分组：```usermod -g 新组名称 用户名```


取值 | 说明
---|---
-c | 修改用户账号的备注文字
-d | 修改用户登录时的目录
-e | 修改账号的有效期
-f | 修改密码过期后多少天关闭账号
-g | 修改用户所属的群组
-G | 修改用户所属的附加组
-l | 修改用户账号名称
-L | 锁定用户密码，使密码无效
-u | 修改用户 id
-U | 解除密码锁定


### 添加用户组命令

```bash
groupadd
```

- 语法：```groupadd [选项] [组名称]```
- 修改用户登录名：```groupadd 组名```
- 修改用户所属分组：```groupadd -g 组 GID 组名```


取值 | 说明
---|---
-g | 指定工作组的 id
-r | 创建系统工作组
-o | 允许添加组 ID 不唯一的工作组
缺省 | 添加用户分组


### 权限操作

Linux 操作系统为文件定义了读、写执行三种权限，不同的用户或者用户组可以具有不同的权限，系统采用 “r”、“w”、“x“ 来分别表示文件的读、写、执行权限。使用 ls -l 命令可以查看到用户在当前目录或者文件的操作权限。

举例：

```bash
drwxr -xr -x. 2 root root 4096 Sep 23 2011 bin
```

从左至右分别表示如下含义：
- d：代表 bin 数目目录而不是文件
- rwx：代表拥有者具有读、写、执行的权限
- r -x：代表同组用户具有读、执行的权限，但是没有写权限
- r -x：代表其他组用户具有读、执行权限，没有写权限

常用的变更权限命令：```chmod```

语法：```chmod [选项] [参数]```

取值 | 说明
---|---
-c | 显示指令执行过程，但只返回更改的部分
-f | 不显示错误信息
-r | 递归授权
-v | 显示指令执行过程

chmod 的参数可以分为两种，分别是权限模式和数字模式。

**权限模式**

权限模式使用 u、g、o 分别代表拥有者、同组用户、其他组用户，使用 + 和 - 代表赋予和收回权限，使用 r、w、x 代表读、写、执行权限。

例如：将文件 01 的执行权限给当前用户 ，写权限赋给用户所在的用户组和其他用户。

```bash
chmod -r U+X,G+W F01
```

例如：将文件 f01 的读、写、执行权限赋给当前用户，将读、写权限赋给用户所在的用户组和其他用户。

```bash
chmod -r u=rwx,g=rw,o=rw f01
```


**数字模式**

为了简化授权步骤，用户也可以采用数字模式进行授权，使用二进制的形式代表r、w、x三种权限，如 ```101(5)=r -x```, ```111(7)=rwx```, ```100(3)=r- -```

例如：将文件 f01 的读、写、执行权限赋给当前用户，将读和执行权限赋给用户组、将写和执行权限赋给其他用户。

```bash
chmod 753 -r f01
```

例如：将文件 f01 的读、写、执行权限赋给所有用户。

```bash
chmod 777 -r f01
```


